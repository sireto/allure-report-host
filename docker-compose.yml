version: '3.8'

services:
  api:
    image: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}
    ports:
      - "8088:8088"
    environment:
      RUST_ENV: production
      API_KEY: ${API_KEY}
      DATA_DIR: /opt/allure-data
    volumes:
      - allure-data:/opt/allure-data
    deploy:
      replicas: 1
      restart_policy:
        condition: on-failure

volumes:
  allure-data:
    driver: local